<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>My Apps</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #fafcff, #e9ecef);
      overflow-x: hidden;
      padding-bottom: env(safe-area-inset-bottom);
      transition: background 0.5s ease;
      position: relative;
    }

    body.dark {
      background: linear-gradient(180deg, #1a1a38, #262650);
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(233, 69, 96, 0.12), rgba(74, 144, 226, 0.12));
      opacity: 0.35;
      z-index: -1;
      animation: aurora 18s ease infinite;
      will-change: transform;
    }

    @keyframes aurora {
      0% { transform: translateY(0); }
      50% { transform: translateY(-25px); }
      100% { transform: translateY(0); }
    }

    .search-bar {
      position: sticky;
      top: 0;
      background: rgba(255, 255, 255, 0.97);
      backdrop-filter: blur(15px);
      padding: 14px 16px;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
    }

    .search-bar input {
      flex: 1;
      padding: 12px 16px;
      border: none;
      border-radius: 16px;
      background: rgba(0, 0, 0, 0.1);
      font-size: 0.95rem;
      outline: none;
      transition: background 0.3s ease, transform 0.2s ease;
    }

    .search-bar input:focus {
      transform: scale(1.02);
    }

    .search-bar input::placeholder {
      color: #888;
    }

    .search-bar .clear-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      color: #e94560;
      cursor: pointer;
      padding: 6px;
      transition: transform 0.2s ease;
      display: none;
    }

    .search-bar .clear-btn.visible {
      display: block;
    }

    .search-bar .clear-btn:active {
      transform: scale(0.9);
    }

    .dark .search-bar {
      background: rgba(30, 30, 50, 0.97);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
    }

    .dark .search-bar input {
      background: rgba(255, 255, 255, 0.18);
      color: #fff;
    }

    .dark .search-bar input::placeholder {
      color: #aaa;
    }

    .app-grid {
      padding: 0 16px calc(120px + env(safe-area-inset-bottom));
      display: grid;
      gap: 18px;
      grid-template-columns: 1fr;
      position: relative;
    }

    .app-grid.list {
      display: block;
    }

    .app-grid.carousel {
      display: flex;
      overflow-x: auto;
      gap: 16px;
      padding-bottom: 24px;
      scrollbar-width: none;
    }

    .app-grid.carousel::-webkit-scrollbar {
      display: none;
    }

    .app-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(16px);
      padding: 22px;
      border-radius: 24px;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.15), inset 0 1px 4px rgba(255, 255, 255, 0.3);
      text-decoration: none;
      color: inherit;
      display: flex;
      align-items: center;
      gap: 18px;
      position: relative;
      overflow: hidden;
      transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.5s ease;
      touch-action: manipulation;
      cursor: pointer;
      border: 1px solid rgba(233, 69, 96, 0.3);
      will-change: transform, box-shadow;
    }

    .list .app-card {
      margin-bottom: 16px;
    }

    .carousel .app-card {
      flex: 0 0 280px;
      margin-right: 16px;
    }

    .dark .app-card {
      background: rgba(40, 40, 60, 0.98);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(233, 69, 96, 0.4);
    }

    .app-card:active {
      transform: scale(0.9);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
    }

    .app-card .icon {
      font-size: 2.6rem;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #e94560, #d43f57);
      color: white;
      border-radius: 18px;
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.5s ease;
    }

    .app-card:active .icon {
      transform: scale(1.2) rotate(10deg);
    }

    .app-card .content {
      flex: 1;
    }

    .app-card h3 {
      font-size: 1.2rem;
      color: #1a1a2e;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .dark .app-card h3 {
      color: #fff;
    }

    .app-card p {
      font-size: 0.9rem;
      color: #555;
      line-height: 1.5;
    }

    .dark .app-card p {
      color: #ccc;
    }

    .app-card .category {
      font-size: 0.8rem;
      color: #e94560;
      background: rgba(233, 69, 96, 0.3);
      padding: 5px 14px;
      border-radius: 16px;
      display: inline-block;
      margin-top: 10px;
    }

    .app-card .favorite {
      position: absolute;
      right: 22px;
      top: 22px;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
      transition: transform 0.3s ease, color 0.3s ease;
    }

    .app-card .favorite.active {
      color: #e94560;
      transform: scale(1.3);
      animation: pulseStar 0.3s ease;
    }

    @keyframes pulseStar {
      0% { transform: scale(1); }
      50% { transform: scale(1.5); }
      100% { transform: scale(1.3); }
    }

    /* Ripple Effect */
    .app-card::before {
      content: '';
      position: absolute;
      background: radial-gradient(circle, rgba(233, 69, 96, 0.5), transparent);
      border-radius: 50%;
      width: 240px;
      height: 240px;
      transform: translate(-50%, -50%) scale(0);
      pointer-events: none;
      transition: transform 0.6s ease, opacity 0.6s ease;
      opacity: 0;
    }

    .app-card.ripple::before {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .modal.active {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background: rgba(255, 255, 255, 0.99);
      backdrop-filter: blur(16px);
      border-radius: 22px;
      padding: 32px;
      max-width: 92%;
      max-height: 85%;
      overflow-y: auto;
      transform: scale(0.7);
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
    }

    .modal.active .modal-content {
      transform: scale(1);
    }

    .dark .modal-content {
      background: rgba(40, 40, 60, 0.99);
    }

    .modal-content h2 {
      font-size: 1.6rem;
      color: #1a1a2e;
      margin-bottom: 16px;
    }

    .dark .modal-content h2 {
      color: #fff;
    }

    .modal-content p {
      font-size: 1rem;
      color: #555;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .dark .modal-content p {
      color: #ccc;
    }

    .modal-content .icon {
      font-size: 3.8rem;
      margin-bottom: 20px;
    }

    .modal-content .category {
      font-size: 0.9rem;
      color: #e94560;
      background: rgba(233, 69, 96, 0.3);
      padding: 6px 16px;
      border-radius: 16px;
      display: inline-block;
      margin-bottom: 20px;
    }

    .modal-content a {
      display: inline-block;
      padding: 16px 32px;
      background: linear-gradient(135deg, #e94560, #d43f57);
      color: #fff;
      border-radius: 16px;
      text-decoration: none;
      font-size: 1.1rem;
      font-weight: 600;
      transition: transform 0.2s ease;
    }

    .modal-content a:focus {
      outline: 2px solid #e94560;
      outline-offset: 4px;
    }

    .modal-content a:active {
      transform: scale(0.95);
    }

    .modal-content .close-btn {
      background: none;
      font-size: 1.3rem;
      color: #888;
      position: absolute;
      top: 18px;
      right: 18px;
      border: none;
      cursor: pointer;
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(26, 26, 46, 0.97);
      backdrop-filter: blur(18px);
      display: flex;
      justify-content: space-around;
      padding: 18px 0 env(safe-area-inset-bottom);
      box-shadow: 0 -5px 12px rgba(0, 0, 0, 0.3);
      z-index: 10;
    }

    .dark .bottom-nav {
      background: rgba(20, 20, 40, 0.97);
    }

    .bottom-nav button {
      background: none;
      border: none;
      color: #fff;
      font-size: 0.8rem;
      padding: 16px;
      cursor: pointer;
      flex: 1;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 7px;
      transition: color 0.4s ease, transform 0.4s ease;
      position: relative;
      touch-action: manipulation;
    }

    .bottom-nav button.active {
      color: #e94560;
      transform: scale(1.3);
    }

    .bottom-nav button:active {
      transform: scale(0.85);
    }

    .bottom-nav .icon {
      font-size: 1.8rem;
      transition: transform 0.4s ease;
      animation: wobble 2s ease infinite;
    }

    .bottom-nav button.active .icon {
      transform: translateY(-4px);
      animation: none;
    }

    @keyframes wobble {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(5deg); }
      75% { transform: rotate(-5deg); }
    }

    .bottom-nav .badge {
      position: absolute;
      top: 12px;
      right: 24px;
      background: #e94560;
      color: #fff;
      font-size: 0.7rem;
      padding: 4px 8px;
      border-radius: 14px;
      display: none;
    }

    .bottom-nav .badge.visible {
      display: block;
    }

    /* Settings Section */
    .settings {
      padding: 32px 16px;
    }

    .settings h2 {
      font-size: 1.5rem;
      color: #1a1a2e;
      margin-bottom: 28px;
    }

    .dark .settings h2 {
      color: #fff;
    }

    .settings label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 0;
      font-size: 1.1rem;
      color: #1a1a2e;
      width: 100%;
    }

    .dark .settings label {
      color: #fff;
    }

    .theme-options, .layout-options {
      display: flex;
      gap: 12px;
    }

    .theme-option, .layout-option {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }

    .theme-option:hover, .layout-option:hover {
      transform: scale(1.1);
      box-shadow: 0 5px 12px rgba(233, 69, 96, 0.3);
    }

    .theme-option.selected, .layout-option.selected {
      transform: scale(1.2);
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }

    /* Pull-to-Refresh */
    .pull-refresh {
      position: absolute;
      top: -90px;
      left: 0;
      right: 0;
      height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e94560;
      font-size: 0.95rem;
      opacity: 0;
      transition: opacity 0.4s ease, transform 0.4s ease;
      z-index: 5;
    }

    .pull-refresh.visible {
      opacity: 1;
      transform: translateY(90px);
    }

    .pull-refresh .spinner {
      display: none;
      width: 30px;
      height: 30px;
      border: 4px solid #e94560;
      border-top: 4px solid transparent;
      border-radius: 50%;
      animation: spin 1.2s linear infinite;
    }

    .pull-refresh.refreshing .spinner {
      display: block;
    }

    .pull-refresh.refreshing span {
      display: none;
    }

    .pull-refresh .progress-arc {
      position: absolute;
      width: 30px;
      height: 30px;
      display: none;
    }

    .pull-refresh.refreshing .progress-arc {
      display: block;
    }

    .pull-refresh .progress-arc circle {
      fill: none;
      stroke: #e94560;
      stroke-width: 4;
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: center;
      stroke-dasharray: 94;
      stroke-dashoffset: 94;
      animation: arcProgress 1.2s linear forwards;
    }

    @keyframes arcProgress {
      to { stroke-dashoffset: 0; }
    }

    /* Offline Indicator */
    .offline-indicator {
      position: fixed;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      background: #e94560;
      color: #fff;
      font-size: 0.85rem;
      padding: 10px 20px;
      border-radius: 14px;
      display: none;
      z-index: 30;
      animation: fadeInOut 0.5s ease;
    }

    .offline-indicator.visible {
      display: block;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
      100% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    /* No Results Animation */
    .no-results {
      animation: pulse 1.5s ease infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    /* Animations */
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes slideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spark {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; }
    }

    /* Responsive Adjustments */
    @media (min-width: 768px) {
      .app-grid {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 24px calc(130px + env(safe-area-inset-bottom));
      }

      .app-grid.list {
        display: block;
      }

      .app-grid.carousel {
        display: flex;
      }

      .app-card h3 {
        font-size: 1.3rem;
      }

      .app-card p {
        font-size: 0.95rem;
      }

      .app-card .icon {
        width: 64px;
        height: 64px;
        font-size: 2.8rem;
      }

      .bottom-nav button {
        font-size: 0.85rem;
      }

      .bottom-nav .icon {
        font-size: 1.9rem;
      }

      .search-bar input {
        font-size: 1.05rem;
      }

      .settings h2 {
        font-size: 1.7rem;
      }

      .settings label {
        font-size: 1.2rem;
      }

      .modal-content {
        max-width: 520px;
      }
    }
  </style>
</head>
<body>
  <div class="app-grid" id="app-grid">
    <div class="pull-refresh" id="pull-refresh">
      <span>Pull to Refresh</span>
      <div class="spinner"></div>
      <svg class="progress-arc"><circle cx="15" cy="15" r="15"/></svg>
    </div>
    <div class="search-bar">
      <input type="text" id="search-input" placeholder="Search apps...">
      <button class="clear-btn" id="clear-btn">✕</button>
    </div>
    <!-- App cards populated by JavaScript -->
  </div>
  <div class="bottom-nav">
    <button class="nav-btn active" data-section="home">
      <span class="icon">🏠</span>
      Home
    </button>
    <button class="nav-btn" data-section="favorites">
      <span class="icon">⭐</span>
      Favorites
      <span class="badge" id="favorites-badge"></span>
    </button>
    <button class="nav-btn" data-section="settings">
      <span class="icon">⚙️</span>
      Settings
    </button>
  </div>
  <div class="modal" id="app-modal">
    <div class="modal-content">
      <button class="close-btn" id="modal-close">✕</button>
      <!-- Modal content populated by JavaScript -->
    </div>
  </div>
  <div class="offline-indicator" id="offline-indicator">Offline Mode</div>
  <canvas id="particles" style="position: fixed; top: 0; left: 0; z-index: -1;"></canvas>

  <script>
    // Array of app projects
    const apps = [
      {
        title: "Calculator",
        description: "Perform quick calculations with ease.",
        link: "calculator.html", // Replace with your project file or URL
        icon: "🧮",
        category: "Utility",
        id: "calc",
        preview: "Basic arithmetic, scientific functions, and history tracking."
      },
      {
        title: "Todo List",
        description: "Organize tasks efficiently.",
        link: "todo.html", // Replace with your project file or URL
        icon: "📋",
        category: "Productivity",
        id: "todo",
        preview: "Add, edit, and prioritize tasks with reminders."
      },
      {
        title: "Weather",
        description: "Get real-time weather updates.",
        link: "weather.html", // Replace with your project file or URL
        icon: "⛅",
        category: "Weather",
        id: "weather",
        preview: "Hourly forecasts, radar maps, and alerts."
      },
      {
        title: "Notes",
        description: "Jot down ideas on the go.",
        link: "notes.html", // Replace with your project file or URL
        icon: "📝",
        category: "Productivity",
        id: "notes",
        preview: "Rich text notes with tags and cloud sync."
      },
      {
        title: "Calendar",
        description: "Plan your events seamlessly.",
        link: "calendar.html", // Replace with your project file or URL
        icon: "📅",
        category: "Productivity",
        id: "calendar",
        preview: "Manage events, set reminders, and share schedules."
      }
    ];

    // Load state from localStorage
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let theme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    let layout = localStorage.getItem('layout') || 'grid';
    let searchQuery = '';
    let scrollPosition = 0;
    document.body.classList.toggle('dark', theme === 'dark');

    // Debounce utility
    function debounce(fn, ms) {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), ms);
      };
    }

    // Update favorites badge
    function updateFavoritesBadge() {
      const badge = document.getElementById('favorites-badge');
      if (badge) {
        badge.textContent = favorites.length;
        badge.classList.toggle('visible', favorites.length > 0);
      }
    }
    updateFavoritesBadge();

    // Populate app grid
    const appGrid = document.getElementById('app-grid');
    function renderApps() {
      appGrid.className = `app-grid ${layout}`;
      appGrid.dataset.section = 'home';
      const existingContent = appGrid.querySelector('.app-content');
      if (!existingContent) {
        appGrid.innerHTML = `
          <div class="pull-refresh" id="pull-refresh">
            <span>Pull to Refresh</span>
            <div class="spinner"></div>
            <svg class="progress-arc"><circle cx="15" cy="15" r="15"/></svg>
          </div>
          <div class="search-bar">
            <input type="text" id="search-input" placeholder="Search apps...">
            <button class="clear-btn" id="clear-btn">✕</button>
          </div>
          <div class="app-content"></div>
        `;
      }
      const content = appGrid.querySelector('.app-content');
      let filteredApps = apps.filter(app => app.title.toLowerCase().includes(searchQuery.toLowerCase()));
      if (filteredApps.length === 0) {
        content.innerHTML = `<p class="no-results" style="text-align: center; color: #555; padding: 20px; font-size: 0.9rem; font-weight: 500;">No apps found!</p>`;
      } else {
        content.innerHTML = '';
        filteredApps.forEach((app, index) => {
          const card = document.createElement('div');
          card.className = 'app-card';
          card.style.animation = `slideIn 0.4s ease ${index * 0.1}s forwards`;
          card.style.opacity = '0';
          card.style.transform = 'translateY(30px)';
          card.dataset.id = app.id;
          card.innerHTML = `
            <span class="icon">${app.icon}</span>
            <div class="content">
              <h3>${app.title}</h3>
              <p>${app.description}</p>
              <span class="category">${app.category}</span>
            </div>
            <span class="favorite ${favorites.includes(app.id) ? 'active' : ''}" data-id="${app.id}">${favorites.includes(app.id) ? '★' : '☆'}</span>
          `;
          content.appendChild(card);
        });
      }
      // Attach listeners after rendering
      attachGridListeners();
      // Restore scroll position
      appGrid.scrollTop = scrollPosition;
      // Cache apps for offline
      localStorage.setItem('appsCache', JSON.stringify(apps));
    }
    renderApps();

    // Render favorites section
    function renderFavorites() {
      appGrid.className = `app-grid ${layout}`;
      appGrid.dataset.section = 'favorites';
      const existingContent = appGrid.querySelector('.app-content');
      if (!existingContent) {
        appGrid.innerHTML = `
          <div class="pull-refresh" id="pull-refresh">
            <span>Pull to Refresh</span>
            <div class="spinner"></div>
            <svg class="progress-arc"><circle cx="15" cy="15" r="15"/></svg>
          </div>
          <div class="search-bar">
            <input type="text" id="search-input" placeholder="Search favorites...">
            <button class="clear-btn" id="clear-btn">✕</button>
          </div>
          <div class="app-content"></div>
        `;
      }
      const content = appGrid.querySelector('.app-content');
      let favoriteApps = apps.filter(app => favorites.includes(app.id) && app.title.toLowerCase().includes(searchQuery.toLowerCase()));
      if (favoriteApps.length === 0) {
        content.innerHTML = `<p class="no-results" style="text-align: center; color: #555; padding: 20px; font-size: 0.9rem; font-weight: 500;">No favorites yet!</p>`;
      } else {
        content.innerHTML = '';
        favoriteApps.forEach((app, index) => {
          const card = document.createElement('div');
          card.className = 'app-card';
          card.style.animation = `slideIn 0.4s ease ${index * 0.1}s forwards`;
          card.style.opacity = '0';
          card.style.transform = 'translateY(30px)';
          card.dataset.id = app.id;
          card.innerHTML = `
            <span class="icon">${app.icon}</span>
            <div class="content">
              <h3>${app.title}</h3>
              <p>${app.description}</p>
              <span class="category">${app.category}</span>
            </div>
            <span class="favorite active" data-id="${app.id}">★</span>
          `;
          content.appendChild(card);
        });
      }
      // Attach listeners after rendering
      attachGridListeners();
      // Restore scroll position
      appGrid.scrollTop = scrollPosition;
    }

    // Attach grid listeners
    function attachGridListeners() {
      const searchInput = document.getElementById('search-input');
      const clearBtn = document.getElementById('clear-btn');
      if (searchInput) {
        searchInput.value = searchQuery;
        searchInput.addEventListener('input', debounce((e) => {
          searchQuery = e.target.value;
          if (clearBtn) clearBtn.classList.toggle('visible', searchQuery.length > 0);
          scrollPosition = appGrid.scrollTop;
          if (appGrid.dataset.section === 'home') {
            renderApps();
          } else {
            renderFavorites();
          }
        }, 300));
      }
      if (clearBtn) {
        clearBtn.classList.toggle('visible', searchQuery.length > 0);
        clearBtn.addEventListener('click', () => {
          searchQuery = '';
          if (searchInput) searchInput.value = '';
          clearBtn.classList.remove('visible');
          scrollPosition = appGrid.scrollTop;
          if (appGrid.dataset.section === 'home') {
            renderApps();
          } else {
            renderFavorites();
          }
        });
      }
      // Lazy-load animations
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.animationPlayState = 'running';
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.1 });
      document.querySelectorAll('.app-card').forEach(card => {
        observer.observe(card);
        const star = card.querySelector('.favorite');
        if (star) {
          star.addEventListener('click', (e) => {
            e.preventDefault();
            const id = star.dataset.id;
            if (favorites.includes(id)) {
              favorites = favorites.filter(fav => fav !== id);
              star.classList.remove('active');
              star.textContent = '☆';
            } else {
              favorites.push(id);
              star.classList.add('active');
              star.textContent = '★';
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesBadge();
            if (appGrid.dataset.section === 'favorites') {
              scrollPosition = appGrid.scrollTop;
              renderFavorites();
            }
          });
        }
        card.addEventListener('click', (e) => {
          if (!e.target.classList.contains('favorite')) {
            const app = apps.find(a => a.id === card.dataset.id);
            scrollPosition = appGrid.scrollTop;
            showAppModal(app);
          }
        });
      });
    }

    // Show app modal
    function showAppModal(app) {
      const modal = document.getElementById('app-modal');
      const modalContent = modal.querySelector('.modal-content');
      modalContent.innerHTML = `
        <button class="close-btn" id="modal-close">✕</button>
        <div class="icon">${app.icon}</div>
        <h2>${app.title}</h2>
        <p>${app.description}</p>
        <span class="category">${app.category}</span>
        <p>${app.preview}</p>
        <a href="${app.link}">Launch App</a>
      `;
      modal.classList.add('active');
      modalContent.querySelector('a').focus();
      document.getElementById('modal-close').addEventListener('click', () => {
        modal.classList.remove('active');
      });
    }

    // Render settings section
    function renderSettings() {
      appGrid.className = 'app-grid';
      appGrid.dataset.section = 'settings';
      appGrid.innerHTML = `
        <div class="settings">
          <h2>Settings</h2>
          <label>
            Theme
          <div class="theme-options">
            <div class="theme-option" style="background: #fafcff;" data-theme="light"></div>
            <div class="theme-option" style="background: #1a1a38;" data-theme="dark"></div>
            <div class="theme-option" style="background: linear-gradient(135deg, #fafcff, #1a1a38);" data-theme="auto"></div>
          </div>
          </label>
          <label>
            Layout
            <div class="layout-options">
              <div class="layout-option" style="background: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><rect x=\"4\" y=\"4\" width=\"8\" height=\"8\" fill=\"%23e94560\"/><rect x=\"14\" y=\"4\" width=\"8\" height=\"8\" fill=\"%23e94560\"/><rect x=\"4\" y=\"14\" width=\"8\" height=\"8\" fill=\"%23e94560\"/><rect x=\"14\" y=\"14\" width=\"8\" height=\"8\" fill=\"%23e94560\"/></svg>'); background-size: cover;" data-layout="grid"></div>
              <div class="layout-option" style="background: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><rect x=\"4\" y=\"4\" width=\"16\" height=\"4\" fill=\"%23e94560\"/><rect x=\"4\" y=\"10\" width=\"16\" height=\"4\" fill=\"%23e94560\"/><rect x=\"4\" y=\"16\" width=\"16\" height=\"4\" fill=\"%23e94560\"/></svg>'); background-size: cover;" data-layout="list"></div>
              <div class="layout-option" style="background: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><rect x=\"4\" y=\"4\" width=\"6\" height=\"16\" fill=\"%23e94560\"/><rect x=\"12\" y=\"4\" width=\"6\" height=\"16\" fill=\"%23e94560\"/><rect x=\"20\" y=\"4\" width=\"6\" height=\"16\" fill=\"%23e94560\"/></svg>'); background-size: cover;" data-layout="carousel"></div>
            </div>
          </label>
        </div>
      `;
      document.querySelectorAll('.theme-option').forEach(option => {
        option.classList.toggle('selected', option.dataset.theme === theme);
        option.addEventListener('click', () => {
          const oldTheme = theme;
          theme = option.dataset.theme;
          document.body.classList.toggle('dark', theme === 'dark');
          localStorage.setItem('theme', theme);
          document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          // Preview theme
          document.body.classList.add('preview');
          setTimeout(() => document.body.classList.remove('preview'), 1000);
        });
      });
      document.querySelectorAll('.layout-option').forEach(option => {
        option.classList.toggle('selected', option.dataset.layout === layout);
        option.addEventListener('click', () => {
          layout = option.dataset.layout;
          localStorage.setItem('layout', layout);
          document.querySelectorAll('.layout-option').forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          scrollPosition = 0;
          renderApps();
        });
      });
    }

    // Bottom navigation
    let isNavigating = false;
    const navButtons = document.querySelectorAll('.nav-btn');
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        if (isNavigating) return;
        isNavigating = true;
        navButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        searchQuery = '';
        scrollPosition = appGrid.scrollTop;
        createParticleSpark();
        appGrid.style.transition = 'transform 0.3s ease';
        appGrid.style.transform = 'translateX(-20px)';
        setTimeout(() => {
          appGrid.style.transform = 'translateX(0)';
          if (button.dataset.section === 'home') {
            renderApps();
          } else if (button.dataset.section === 'favorites') {
            renderFavorites();
          } else {
            renderSettings();
          }
          isNavigating = false;
        }, 300);
      });
    });

    // Swipe gesture for navigation
    let touchStartX = 0;
    let touchEndX = 0;
    let touchStartTime = 0;
    document.addEventListener('touchstart', e => {
      touchStartX = e.touches[0].clientX;
      touchStartTime = Date.now();
    });
    document.addEventListener('touchend', e => {
      if (isNavigating) return;
      touchEndX = e.changedTouches[0].clientX;
      const swipeDistance = touchEndX - touchStartX;
      const swipeTime = Date.now() - touchStartTime;
      const velocity = Math.abs(swipeDistance / swipeTime);
      if (Math.abs(swipeDistance) > 40 || velocity > 0.3) {
        isNavigating = true;
        const currentIndex = Array.from(navButtons).findIndex(btn => btn.classList.contains('active'));
        let nextIndex = currentIndex;
        if (swipeDistance > 0 && currentIndex > 0) {
          nextIndex = currentIndex - 1;
        } else if (swipeDistance < 0 && currentIndex < navButtons.length - 1) {
          nextIndex = currentIndex + 1;
        }
        if (nextIndex !== currentIndex) {
          navButtons.forEach(btn => btn.classList.remove('active'));
          navButtons[nextIndex].classList.add('active');
          searchQuery = '';
          scrollPosition = appGrid.scrollTop;
          createParticleSpark();
          appGrid.style.transition = 'transform 0.3s ease';
          appGrid.style.transform = `translateX(${swipeDistance > 0 ? '20px' : '-20px'})`;
          setTimeout(() => {
            appGrid.style.transform = 'translateX(0)';
            const section = navButtons[nextIndex].dataset.section;
            if (section === 'home') {
              renderApps();
            } else if (section === 'favorites') {
              renderFavorites();
            } else {
              renderSettings();
            }
            isNavigating = false;
          }, 300);
        } else {
          isNavigating = false;
        }
      }
    });

    // Pull-to-refresh
    let touchStartY = 0;
    let touchCurrentY = 0;
    document.addEventListener('touchstart', e => {
      touchStartY = e.touches[0].clientY;
    });
    document.addEventListener('touchmove', e => {
      touchCurrentY = e.touches[0].clientY;
      const pullDistance = touchCurrentY - touchStartY;
      const pullRefresh = document.getElementById('pull-refresh');
      if (pullDistance > 0 && window.scrollY === 0 && pullRefresh) {
        const stretch = pullDistance > 110 ? pullDistance * 0.5 : pullDistance;
        pullRefresh.style.transform = `translateY(${Math.min(stretch, 90)}px)`;
        pullRefresh.classList.add('visible');
      }
    });
    document.addEventListener('touchend', () => {
      const pullDistance = touchCurrentY - touchStartY;
      const pullRefresh = document.getElementById('pull-refresh');
      if (pullDistance > 110 && pullRefresh) {
        pullRefresh.classList.add('refreshing');
        scrollPosition = 0;
        setTimeout(() => {
          const currentSection = appGrid.dataset.section;
          if (currentSection === 'home') {
            renderApps();
          } else if (currentSection === 'favorites') {
            renderFavorites();
          }
          if (pullRefresh) {
            pullRefresh.style.transform = 'translateY(0)';
            pullRefresh.classList.remove('visible', 'refreshing');
          }
        }, 1200);
      } else if (pullRefresh) {
        pullRefresh.style.transform = 'translateY(0)';
        pullRefresh.classList.remove('visible');
      }
    });

    // Ripple effect on card tap
    document.addEventListener('touchstart', (e) => {
      const card = e.target.closest('.app-card');
      if (card && !e.target.classList.contains('favorite')) {
        const rect = card.getBoundingClientRect();
        const x = e.touches[0].clientX - rect.left;
        const y = e.touches[0].clientY - rect.top;
        card.style.setProperty('--ripple-x', `${x}px`);
        card.style.setProperty('--ripple-y', `${y}px`);
        card.classList.add('ripple');
        setTimeout(() => card.classList.remove('ripple'), 600);
      }
    });

    // Parallax tilt effect
    let lastTiltUpdate = 0;
    document.addEventListener('deviceorientation', (e) => {
      const now = Date.now();
      if (now - lastTiltUpdate < 50) return; // Throttle to 20fps
      lastTiltUpdate = now;
      const tiltX = e.beta / 90;
      const tiltY = e.gamma / 90;
      document.querySelectorAll('.app-card').forEach(card => {
        card.style.setProperty('--tilt-x', `${tiltX * 8}deg`);
        card.style.setProperty('--tilt-y', `${tiltY * 8}deg`);
        card.style.transform = `perspective(1200px) rotateX(var(--tilt-x)) rotateY(var(--tilt-y)) scale(0.9)`;
        card.style.boxShadow = `${tiltY * 5}px ${tiltX * 5}px 24px rgba(0, 0, 0, 0.15), inset 0 1px 4px rgba(255, 255, 255, 0.3)`;
      });
    });

    // Offline support
    const offlineIndicator = document.getElementById('offline-indicator');
    window.addEventListener('offline', () => {
      if (offlineIndicator) offlineIndicator.classList.add('visible');
      const cachedApps = JSON.parse(localStorage.getItem('appsCache') || '[]');
      if (cachedApps.length > 0 && cachedApps.every(app => app.id && app.title)) {
        apps.length = 0;
        apps.push(...cachedApps);
        scrollPosition = 0;
        if (appGrid.dataset.section === 'home') {
          renderApps();
        } else if (appGrid.dataset.section === 'favorites') {
          renderFavorites();
        }
      }
    });
    window.addEventListener('online', () => {
      if (offlineIndicator) offlineIndicator.classList.remove('visible');
      scrollPosition = 0;
      if (appGrid.dataset.section === 'home') {
        renderApps();
      } else if (appGrid.dataset.section === 'favorites') {
        renderFavorites();
      }
    });

    // Particle spark on interaction
    function createParticleSpark() {
      const canvas = document.getElementById('particles');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const particles = [];
      for (let i = 0; i < 15; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 80 + 40;
        const size = Math.random() * 5 + 2;
        particles.push({
          x: canvas.width / 2,
          y: canvas.height / 2,
          size,
          dx: Math.cos(angle) * speed,
          dy: Math.sin(angle) * speed,
          opacity: 1
        });
      }
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          p.x += p.dx / 60;
          p.y += p.dy / 60;
          p.size *= 0.96;
          p.opacity *= 0.95;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(233, 69, 96, ${p.opacity})`;
          ctx.fill();
        });
        if (particles.some(p => p.size > 0.1)) requestAnimationFrame(animate);
      }
      animate();
    }

    // Apply accent color
    document.documentElement.style.setProperty('--accent', '#e94560');

    // Preload cached apps
    const cachedApps = JSON.parse(localStorage.getItem('appsCache') || '[]');
    if (cachedApps.length > 0 && cachedApps.every(app => app.id && app.title)) {
      apps.length = 0;
      apps.push(...cachedApps);
    }
  </script>
</body>
</html>
